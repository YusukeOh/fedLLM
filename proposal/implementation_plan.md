# 実装計画：Macroeconomic Forecasting with LLM speaking Fed's dialect

## プロジェクト概要

Time-LLM（Jin et al., 2024）をベースに、FRBのドメイン知識（FOMC声明文・議事録の語彙）を組み込んだマクロ経済予測モデルを構築する。3段階アプローチ（Step 1a: Domain-Anchored PaP、Step 1b: FOMC声明文PaP、Step 2: Fed語彙によるReprogramming）で進める。

---

## フェーズ構成

### フェーズ0：環境構築・先行研究の再現（2〜3週間）

| タスク | 内容 |
|--------|------|
| 0-1 | 開発環境のセットアップ（Python, PyTorch, HuggingFace Transformers等） |
| 0-2 | Time-LLMの[公式リポジトリ](https://github.com/KimMeen/Time-LLM)のコード理解・再現実験 |
| 0-3 | ベースラインモデル（VAR等の伝統的計量経済モデル）の実装 |
| 0-4 | 評価指標の定義（MSE, MAE, MASE等）とベンチマークパイプラインの構築 |

**マイルストーン：** Time-LLMのオリジナル結果を再現し、コードベースの理解を確立する。

---

### フェーズ1：データ収集・前処理（2〜3週間）

| タスク | 内容 |
|--------|------|
| 1-1 | **FRED-MD**データの取得・前処理パイプライン構築（リアルタイムヴィンテージの管理を含む） |
| 1-2 | **FOMC声明文**のスクレイピング・パース（FRBウェブサイトから時系列順に収集） |
| 1-3 | **FOMC議事録**の収集・テキスト前処理 |
| 1-4 | Fed語彙辞書の構築（声明文・議事録から経済用語・表現を抽出、例：「demand-driven inflation」「supply constraints」「labor market tightening」等） |
| 1-5 | 予測時点とFOMC文書の時系列的な対応付け（look-aheadバイアス回避のため、予測時点以前に公開された文書のみを使用するロジック） |

**マイルストーン：** 時系列データとテキストデータが時間軸上で正しく紐付けられた統合データセットが完成する。

---

### フェーズ2：Prompt-as-Prefixの実装（3〜4週間）

| タスク | 内容 |
|--------|------|
| 2-1 | **Step 1a: Domain-Anchored PaP** — 変数名・経済的役割・変換意味を含むプロンプト辞書（29変数分）の作成と実装。統計ベースPaPを置換 |
| 2-2 | Step 1a vs Vanilla Time-LLM（統計ベースPaP）のアブレーション |
| 2-3 | **Step 1b: FOMC声明文PaP** — Step 1aのプロンプトにFOMC声明文を追加する拡張の実装 |
| 2-4 | Step 1b vs Step 1a のアブレーション（FOMC声明文の粗効果の測定） |
| 2-5 | ベースライン（VAR等）との比較分析 |

**マイルストーン：** Domain-Anchored PaPの効果を確認し、FOMC声明文の粗効果を測定する。

---

### フェーズ3：Step 2の実装 — Fed語彙によるReprogramming（4〜6週間、本研究の核心）

| タスク | 内容 |
|--------|------|
| 3-1 | LLMの語彙空間からFed語彙のサブセットを抽出し、Reprogramming層の対象語彙を制限する仕組みの実装 |
| 3-2 | FRED-MDの多変量時系列をFed語彙の埋め込み空間の線形和として学習するReprogramming層の訓練 |
| 3-3 | 語彙制限の粒度に関する実験（声明文のみ vs 声明文＋議事録、語彙サイズの影響等） |
| 3-4 | アテンション・ウェイトの可視化による経済ナラティブ抽出の検証 |
| 3-5 | ケーススタディ：「CPI上昇＋失業率低下→需要過熱」「CPI上昇＋生産停滞→供給制約」等のナラティブが実際に抽出されるかの定性評価 |

**マイルストーン：** RQ2「Fedの語彙で解釈させることでExplainable AIモデルを構築できるか？」に対する回答を得る。

---

### フェーズ4：Look-aheadバイアスの定量化・ロバスト性検証（2〜3週間）

| タスク | 内容 |
|--------|------|
| 4-1 | **LLM訓練打ち切り日テスト** — FOMC声明文の効果を、LLMの学習データ打ち切り日の前後で分離評価。打ち切り後も効果が持続するかを検証 |
| 4-2 | **時間的シャッフル検定** — FOMC声明文をランダムな予測時点に割り当て、時間的同定への依存度を測定 |
| 4-3 | **GPT-2バックボーン検証** — 学習打ち切りがより早い（~2019年末）GPT-2を用いて、2020年以降のデータでlook-ahead-freeの効果を測定 |
| 4-4 | Fedマクロ経済モデル生成データによるバリデーション |
| 4-5 | 予測ホライズン（短期/中期/長期）別の性能比較 |

---

### フェーズ5：論文執筆・成果物整理（3〜4週間）

| タスク | 内容 |
|--------|------|
| 5-1 | 実験結果の整理・図表作成 |
| 5-2 | 論文ドラフトの執筆 |
| 5-3 | コードのリファクタリング・再現性の担保（README, 設定ファイル, シード固定等） |

---

## 推奨ディレクトリ構成

```
fedLLM/
├── proposal/                  # プロポーザル（既存）
├── discussions/               # 議論・計画文書
├── data/
│   ├── raw/                   # 生データ（FRED-MD, FOMC文書）
│   ├── processed/             # 前処理済みデータ
│   └── vocabulary/            # Fed語彙辞書
├── src/
│   ├── data/                  # データ取得・前処理
│   ├── models/
│   │   ├── time_llm/          # Time-LLMベースモデル
│   │   ├── fed_prompt/        # Step 1: Prompt-as-Prefix拡張
│   │   └── fed_reprogram/     # Step 2: Fed語彙Reprogramming
│   ├── baselines/             # VAR等のベースラインモデル
│   ├── evaluation/            # 評価ロジック
│   └── visualization/         # アテンション可視化・ナラティブ抽出
├── notebooks/                 # 探索的分析用Jupyter Notebook
├── configs/                   # 実験設定ファイル
├── scripts/                   # 実験実行スクリプト
├── tests/                     # テストコード
└── results/                   # 実験結果・図表
```

---

## 技術スタック（想定）

- **言語:** Python 3.10+
- **深層学習:** PyTorch, HuggingFace Transformers
- **LLMバックボーン:** LLaMA-7B（Time-LLMの元論文に準拠）
- **計量経済:** statsmodels（VAR等）
- **データ取得:** FRED API（`fredapi`）、FRBウェブサイトスクレイピング（`requests` + `BeautifulSoup`）
- **実験管理:** Weights & Biases or MLflow
- **可視化:** matplotlib, seaborn, plotly

---

## 主要リスクと対策

| リスク | 対策 |
|--------|------|
| **Look-aheadバイアス（データ管理）** | FRED-MDのリアルタイムヴィンテージを厳密に使用。FOMC文書は公開日ベースで管理 |
| **Look-aheadバイアス（LLM内在）** | 凍結LLMの事前学習コーパスに埋め込まれた将来情報の漏洩リスク。時間的シャッフル検定・LLM打ち切り日テスト・GPT-2バックボーン検証で定量化（フェーズ4） |
| **計算コスト** | LLMパラメータは凍結（Time-LLMと同様）。学習対象はReprogramming層とプロンプト関連のみ |
| **Fed語彙の網羅性** | 声明文＋議事録の双方から抽出。必要に応じてBeige Bookや講演原稿にも拡張可能 |
| **因果関係の妥当性検証** | ナラティブの定性的レビューをドメイン専門家（経済学者）と共同で実施 |
